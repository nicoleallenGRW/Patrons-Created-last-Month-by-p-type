SELECT 
COUNT(case when patron.ptype_code = '0' then 1 else null end) as "Greenwich Adults",
COUNT(case when patron.ptype_code = '1' then 1 else null end) as "Non Resident Worker",
COUNT(case when patron.ptype_code = '2' then 1 else null end) as "My First Library Card",
COUNT(case when patron.ptype_code = '3' then 1 else null end) as "Ct-Card",
COUNT(case when patron.ptype_code = '4' then 1 else null end) as "Non-resident Fee",
COUNT(case when patron.ptype_code = '5' then 1 else null end) as "GRW YA",
COUNT(case when patron.ptype_code = '6' then 1 else null end) as "Temp Resident",
COUNT(case when patron.ptype_code = '7' then 1 else null end) as "Teacher",
COUNT(case when patron.ptype_code = '8' then 1 else null end) as "Special",
COUNT(case when patron.ptype_code = '9' then 1 else null end) as "Perrot Res A.",
COUNT(case when patron.ptype_code = '10' then 1 else null end) as "GRW Juv",
COUNT(case when patron.ptype_code = '11' then 1 else null end) as "Perrot Res. J",
COUNT(case when patron.ptype_code = '12' then 1 else null end) as "ILL",
COUNT(case when patron.ptype_code = '13' then 1 else null end) as "Reserve",
COUNT(case when patron.ptype_code = '14' then 1 else null end) as "Gold Card",
COUNT(case when patron.ptype_code = '15' then 1 else null end) as "EAN",
COUNT(case when patron.ptype_code = '16' then 1 else null end) as "Library Staff",
COUNT(case when patron.ptype_code = '17' then 1 else null end) as "Operations",
COUNT(case when patron.ptype_code = '18' then 1 else null end) as "PERILL",
COUNT(case when patron.ptype_code = '20' then 1 else null end) as "Trustee",
COUNT(case when patron.ptype_code = '21' then 1 else null end) as "Greenwich Property Owner",
COUNT(case when patron.ptype_code = '22' then 1 else null end) as "Homebound",
COUNT(case when patron.ptype_code = '23' then 1 else null end) as "GRW Summer Res",
COUNT(case when patron.ptype_code = '24' then 1 else null end) as "Non-Res Student Under 13",
COUNT(case when patron.ptype_code = '25' then 1 else null end) as "Non-Res Student 13-16",
COUNT(case when patron.ptype_code = '26' then 1 else null end) as "InfoDesk",
COUNT(case when patron.ptype_code = '27' then 1 else null end) as "Non-Res Student Over 17",
COUNT(case when patron.ptype_code = '28' then 1 else null end) as "EAN, GRW Loans",
COUNT(case when patron.ptype_code = '30' then 1 else null end) as "BYR Adult",
COUNT(case when patron.ptype_code = '31' then 1 else null end) as "BYR Juv",
COUNT(case when patron.ptype_code = '32' then 1 else null end) as "BYR YA",
COUNT(case when patron.ptype_code = '33' then 1 else null end) as "BYR My First",
COUNT(case when patron.ptype_code = '35' then 1 else null end) as "Perr Res YA",
COUNT(case when patron.ptype_code = '36' then 1 else null end) as "Per Res. Homebound",
COUNT(case when patron.ptype_code = '40' then 1 else null end) as "COS Adult",
COUNT(case when patron.ptype_code = '41' then 1 else null end) as "COS Juv",
COUNT(case when patron.ptype_code = '42' then 1 else null end) as "COS YA",
COUNT(case when patron.ptype_code = '43' then 1 else null end) as "COS My First",
COUNT(case when patron.ptype_code = '45' then 1 else null end) as "Bibliocommons Lists",
COUNT(case when patron.ptype_code = '99' then 1 else null end) as "Online Registration",

COUNT(case when meta.creation_date_gmt > now() - interval '30 day' and patron.ptype_code = '0' then 1 end) as "Main Adult 1",
COUNT(case when meta.creation_date_gmt > now() - interval '30 day' and patron.ptype_code = '1' then 1 else null end) as "Non Resident Worker 2",
COUNT(case when meta.creation_date_gmt > now() - interval '30 day' and patron.ptype_code = '2' then 1 else null end) as "My First Library Card 3",
COUNT(case when meta.creation_date_gmt > now() - interval '30 day' and patron.ptype_code = '3' then 1 else null end) as "Ct-Card 4",
COUNT(case when meta.creation_date_gmt > now() - interval '30 day' and patron.ptype_code = '4' then 1 else null end) as "Non-resident Fee 5",
COUNT(case when meta.creation_date_gmt > now() - interval '30 day' and patron.ptype_code = '5' then 1 else null end) as "GRW YA 6",
COUNT(case when meta.creation_date_gmt > now() - interval '30 day' and patron.ptype_code = '6' then 1 else null end) as "Temp Resident 7",
COUNT(case when meta.creation_date_gmt > now() - interval '30 day' and patron.ptype_code = '7' then 1 else null end) as "Teacher 8",
COUNT(case when meta.creation_date_gmt > now() - interval '30 day' and patron.ptype_code = '8' then 1 else null end) as "Special 9",
COUNT(case when meta.creation_date_gmt > now() - interval '30 day' and patron.ptype_code = '9' then 1 else null end) as "Perrot Res A. 10",
COUNT(case when meta.creation_date_gmt > now() - interval '30 day' and patron.ptype_code = '10' then 1 else null end) as "GRW Juv 11",
COUNT(case when meta.creation_date_gmt > now() - interval '30 day' and patron.ptype_code = '11' then 1 else null end) as "Perrot Res. J 12",
COUNT(case when meta.creation_date_gmt > now() - interval '30 day' and patron.ptype_code = '12' then 1 else null end) as "ILL 13",
COUNT(case when meta.creation_date_gmt > now() - interval '30 day' and patron.ptype_code = '13' then 1 else null end) as "Reserve 14",
COUNT(case when meta.creation_date_gmt > now() - interval '30 day' and patron.ptype_code = '14' then 1 else null end) as "Gold Card 15",
COUNT(case when meta.creation_date_gmt > now() - interval '30 day' and patron.ptype_code = '15' then 1 else null end) as "EAN 16",
COUNT(case when meta.creation_date_gmt > now() - interval '30 day' and patron.ptype_code = '16' then 1 else null end) as "Library Staff 17",
COUNT(case when meta.creation_date_gmt > now() - interval '30 day' and patron.ptype_code = '17' then 1 else null end) as "Operations 18",
COUNT(case when meta.creation_date_gmt > now() - interval '30 day' and patron.ptype_code = '18' then 1 else null end) as "PERILL 19",
COUNT(case when meta.creation_date_gmt > now() - interval '30 day' and patron.ptype_code = '20' then 1 else null end) as "Trustee 20",
COUNT(case when meta.creation_date_gmt > now() - interval '30 day' and patron.ptype_code = '21' then 1 else null end) as "Greenwich Property Owner 21",
COUNT(case when meta.creation_date_gmt > now() - interval '30 day' and patron.ptype_code = '22' then 1 else null end) as "Homebound 22",
COUNT(case when meta.creation_date_gmt > now() - interval '30 day' and patron.ptype_code = '23' then 1 else null end) as "GRW Summer Res 23",
COUNT(case when meta.creation_date_gmt > now() - interval '30 day' and patron.ptype_code = '24' then 1 else null end) as "Non-Res Student Under 13 24",
COUNT(case when meta.creation_date_gmt > now() - interval '30 day' and patron.ptype_code = '25' then 1 else null end) as "Non-Res Student 13-16 25",
COUNT(case when meta.creation_date_gmt > now() - interval '30 day' and patron.ptype_code = '26' then 1 else null end) as "InfoDesk 26",
COUNT(case when meta.creation_date_gmt > now() - interval '30 day' and patron.ptype_code = '27' then 1 else null end) as "Non-Res Student Over 17 27",
COUNT(case when meta.creation_date_gmt > now() - interval '30 day' and patron.ptype_code = '28' then 1 else null end) as "EAN, GRW Loans 28",
COUNT(case when meta.creation_date_gmt > now() - interval '30 day' and patron.ptype_code = '30' then 1 else null end) as "BYR Adult 29",
COUNT(case when meta.creation_date_gmt > now() - interval '30 day' and patron.ptype_code = '31' then 1 else null end) as "BYR Juv 30",
COUNT(case when meta.creation_date_gmt > now() - interval '30 day' and patron.ptype_code = '32' then 1 else null end) as "BYR YA 31",
COUNT(case when meta.creation_date_gmt > now() - interval '30 day' and patron.ptype_code = '33' then 1 else null end) as "BYR My First 32",
COUNT(case when meta.creation_date_gmt > now() - interval '30 day' and patron.ptype_code = '35' then 1 else null end) as "Perr Res YA 33",
COUNT(case when meta.creation_date_gmt > now() - interval '30 day' and patron.ptype_code = '36' then 1 else null end) as "Per Res. Homebound 34",
COUNT(case when meta.creation_date_gmt > now() - interval '30 day' and patron.ptype_code = '40' then 1 else null end) as "COS Adult 35",
COUNT(case when meta.creation_date_gmt > now() - interval '30 day' and patron.ptype_code = '41' then 1 else null end) as "COS Juv 36",
COUNT(case when meta.creation_date_gmt > now() - interval '30 day' and patron.ptype_code = '42' then 1 else null end) as "COS YA",
COUNT(case when meta.creation_date_gmt > now() - interval '30 day' and patron.ptype_code = '43' then 1 else null end) as "COS My First",
COUNT(case when meta.creation_date_gmt > now() - interval '30 day' and patron.ptype_code = '45' then 1 else null end) as "Bibliocommons Lists",
COUNT(case when meta.creation_date_gmt > now() - interval '30 day' and patron.ptype_code = '99' then 1 else null end) as "Online Registration"

FROM 
sierra_view.record_metadata as meta
join sierra_view.patron_record as patron on patron.id = meta.id;


--updated dates October 2021
